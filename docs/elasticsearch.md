# Elaticsearch Service

Elaticsearch Serviceã‚’åˆ©ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ©ãƒ•åŒ–ã—ã¾ã™ã€‚

AWS IoTã®ãƒ«ãƒ¼ãƒ«ã®`HelloIotRule`ã‚’é–‹ãã¾ã™ã€‚

![/images/elasticsearch/elasticsearch1.jpg](/images/elasticsearch/elasticsearch1.jpg)

ã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch2.jpg](/images/elasticsearch/elasticsearch2.jpg)

ã€ŒAmazon Elasticsearch Serviceã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã€ã«ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch3.jpg](/images/elasticsearch/elasticsearch3.jpg)


ã¾ã Elasticsearch Serviceã‚’èµ·å‹•ã—ã¦ã„ãªã„ãŸã‚æ–°ã—ãä½œæˆã—ã¾ã™ã€‚
ã€Œæ–°ã—ã„ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch4.jpg](/images/elasticsearch/elasticsearch4.jpg)

æ–°ã—ãElasticsearch Serviceã®ãƒšãƒ¼ã‚¸ãŒé–‹ãã¾ã™ã€‚
ã€Œæ–°ã—ã„ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch5.jpg](/images/elasticsearch/elasticsearch5.jpg)

Elasticserach Serviceã®ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãŒé–‹ã‹ã‚Œã¾ã™ã€‚

ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’`hello-iot`ã¨ã—ã¦ã€Œæ¬¡ã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch6.jpg](/images/elasticsearch/elasticsearch6.jpg)


ç”»åƒã®ç”¨ã«å€¤ã‚’è¨­å®šã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch7.jpg](/images/elasticsearch/elasticsearch7.jpg)

![/images/elasticsearch/elasticsearch8.jpg](/images/elasticsearch/elasticsearch8.jpg)

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚µã‚¤ã‚ºã‚’`t2.small`ã«ã—ãŸã“ã¨ã‚’ç¢ºèªã—ãŸã‚‰ã€Œæ¬¡ã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚


Elasticsearch Serviceã‚’é‹ç”¨ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã‚’è¨­å®šã—ã¾ã™ã€‚  
ä»Šå›ã¯ä½œæ¥­ç°¡æ˜“åŒ–ã™ã‚‹ãŸã‚ã ã‚Œã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªå…¬é–‹çŠ¶æ…‹ã§è¨­å®šã—ã¾ã™ã€‚  
æœ¬ç•ªåˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€VPCã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ–°è¦ã§ä½œæˆã—ã¦é…ç½®ã—ã¦ãã ã•ã„ã€‚

ã€Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã€ã«ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

![/images/elasticsearch/elasticsearch9.jpg](/images/elasticsearch/elasticsearch9.jpg)


ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’é¸æŠã—ã¾ã™ã€‚
ã€Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã€ã‹ã‚‰ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch10.jpg](/images/elasticsearch/elasticsearch10.jpg)

ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€ã€Œãƒªã‚¹ã‚¯ã«åŒæ„ã—ã¾ã™ã€ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€ŒOKã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch11.jpg](/images/elasticsearch/elasticsearch11.jpg)

ç”»åƒã®ã‚ˆã†ãªJSONãŒå…¥åŠ›ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã—ã¦ã€Œæ¬¡ã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch12.jpg](/images/elasticsearch/elasticsearch12.jpg)

ç¢ºèªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€Œç¢ºèªã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch13.jpg](/images/elasticsearch/elasticsearch13.jpg)


Elasticserach ServiceãŒèµ·å‹•ã—ã¦ä½œæˆä¸­ã«ãªã‚Šã¾ã™ã€‚
ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚‹ã¾ã§æ•°åˆ†ã‹ã‹ã‚‹ã®ã§å¾…ã¡ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch14.jpg](/images/elasticsearch/elasticsearch14.jpg)


ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¡¨ç¤ºã«ãªã£ãŸã‚‰ã€AWS IoTã®ç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚
æ›´æ–°ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦`hello-iot`ã‚’æŒ‡å®šã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch15.jpg](/images/elasticsearch/elasticsearch15.jpg)

ãã®å¾Œè¡¨ç¤ºã•ã‚ŒãŸå…¥åŠ›é …ç›®ã‚’åŸ‹ã‚ã¾ã™ã€‚ã€€

|           ID|       ç´¢å¼•|        ã‚¿ã‚¤ãƒ—|
|-------------|----------|-------------|
| ${newuuid()}| hello-iot| temperatures|

ã“ã‚Œã‚‰ã¯Elasticsearch Serviceã®ãŸã‚ã®è¨­å®šã§ã™ã€‚  
Elasticsearch Serviceã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ„ã«ã™ã‚‹ã‚ˆã†`newuuid`é–¢æ•°ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚  
ç´¢å¼•ã¨ã‚¿ã‚¤ãƒ—ã¯RDBã§ã„ã†ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®é–¢ä¿‚ã«ãªã‚Šã¾ã™ã€‚  

AWS IoTã‹ã‚‰Elastic Searchserviceã«ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§ãã‚‹ã‚ˆã†ã«ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
ã€Œæ–°ã—ã„ãƒ­ãƒ¼ãƒ«ã®ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch16.jpg](/images/elasticsearch/elasticsearch16.jpg)

ãƒ­ãƒ¼ãƒ«åã¨ã—ã¦`aws-iot-to-elasticsearch-role`ã¨å…¥åŠ›ã—ã¾ã™ã€‚  
ã€Œæ–°ã—ã„ãƒ­ãƒ¼ãƒ«ã®ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch17.jpg](/images/elasticsearch/elasticsearch17.jpg)


å…ˆç¨‹ä½œã£ãŸ`aws-iot-to-elasticsearch-role`ã‚’è¨­å®šã—ã¦ã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch18.jpg](/images/elasticsearch/elasticsearch18.jpg)


ã“ã“ã¾ã§ã§ã€AWS IoTã§ã®è¨­å®šä½œæ¥­ã¯çµ‚äº†ã§ã™ã€‚
mockmockã§æ¸©åº¦ã®ãƒ¢ãƒƒã‚¯ã‚’èµ·å‹•ã—ã¦ã€AWS IoTçµŒç”±ã§Elasticsearch Serviceã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¾ã—ã‚‡ã†ã€‚

---

AWSã§Elasticearch Serviceã‚’èµ·å‹•ã™ã‚‹ã¨ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹ãŸã‚ã®Kibanaã‚’ä¸€ç·’ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  
ç”»åƒã®ç®‡æ‰€ã®URLã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦Kibanaã‚’èµ·å‹•ã—ã¾ã—ã‚‡ã†ã€‚

![/images/elasticsearch/elasticsearch19.jpg](/images/elasticsearch/elasticsearch19.jpg)


ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€ŒManagementã€ã‹ã‚‰æœ€åˆã®Kibanaã®è¨­å®šã‚’ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch20.jpg](/images/elasticsearch/elasticsearch20.jpg)


ã€ŒIndex Patternsã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch21.jpg](/images/elasticsearch/elasticsearch21.jpg)

Kibanaã«ã©ã‚“ãªãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã‚‹ã‹ã‚’æ•™ãˆã‚‹ãŸã‚Index patternã‚’ç™»éŒ²ã—ã¾ã™ã€‚  
ã“ã“ã§ã¯å…ˆç¨‹AWS IoTã§è¨­å®šã—ãŸ`hello-iot*`ã‚’å…¥åŠ›ã—ã¦ã€Œ> Next Stepã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch22.jpg](/images/elasticsearch/elasticsearch22.jpg)

ã‚¿ã‚¤ãƒ ã«é–¢ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã“ã“ã§ã¯`time`ã‚’é¸æŠã—ã¦ã€ŒCreate index patternã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch23.jpg](/images/elasticsearch/elasticsearch23.jpg)

ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½œæˆãŒå®Œäº†ã™ã‚‹ã¨ç”»åƒã®ã‚ˆã†ãªç”»é¢ã«ãªã‚Šã¾ã™ã€‚ã™ã§ã«ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’è§£æã—ã¦è‡ªå‹•ã§å‹ã‚’è¨­å®šã—ã¦ãã‚Œã¾ã™ã€‚

![/images/elasticsearch/elasticsearch24.jpg](/images/elasticsearch/elasticsearch24.jpg)

ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰Discoverã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚  
å•é¡Œãªã‘ã‚Œã°ç”»åƒã®ã‚ˆã†ãªç”»é¢ã«ãªã‚Šã¾ã™ã€‚

![/images/elasticsearch/elasticsearch24_2.jpg](/images/elasticsearch/elasticsearch24_2.jpg)

---

å…¥ã£ã¦ãã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚ºã—ã¾ã—ã‚‡ã†ã€‚  

ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€ŒVisualizeã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch25.jpg](/images/elasticsearch/elasticsearch25.jpg)

ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆã‚’çµ„ã‚€ãŸã‚ã€ŒLineã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch26.jpg](/images/elasticsearch/elasticsearch26.jpg)

`hello-iot*`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch27.jpg](/images/elasticsearch/elasticsearch27.jpg)

ãƒãƒ£ãƒ¼ãƒˆã‚’è¨­å®šã¨è¡¨ç¤ºã™ã‚‹ç”»é¢ã«ãªã‚Šã¾ã™ã€‚
ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ãƒãƒ£ãƒ¼ãƒˆè¨­å®šã‚’è¡Œã„ã¾ã™ã€‚  
Y-Axisã‚’é–‹ãã¾ã™ã€‚

![/images/elasticsearch/elasticsearch28.jpg](/images/elasticsearch/elasticsearch28.jpg)


ç”»åƒã®ã‚ˆã†ã«Yè»¸ã«temperature1/2ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch29.jpg](/images/elasticsearch/elasticsearch29.jpg)

æ¬¡ã«Xè»¸ã‚’è¨­å®šã—ã¾ã™ã€‚
ã€ŒX-Axisã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch30.jpg](/images/elasticsearch/elasticsearch30.jpg)

Xè»¸ã‚’æ™‚é–“ã«ã™ã‚‹ãŸã‚ã€ç”»åƒã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

![/images/elasticsearch/elasticsearch31.jpg](/images/elasticsearch/elasticsearch31.jpg)


å†ç”Ÿãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è¨­å®šãŒåæ˜ ã•ã‚Œã¦ãƒãƒ£ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
Xè»¸ã®è¨­å®šã‚’å¤‰ãˆãŸã‚Šã€Aggregationã‚’å¤‰æ›´ã—ãŸã‚Šã—ã¦ã¿ã¦ãã ã•ã„ã€‚

![/images/elasticsearch/elasticsearch32.jpg](/images/elasticsearch/elasticsearch32.jpg)

---

ä»¥ä¸Šã§ã€ãƒãƒ³ã‚ºã‚ªãƒ³ã®è³‡æ–™ã¯çµ‚äº†ã§ã™ã€‚  
ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸğŸµ
